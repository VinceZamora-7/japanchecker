<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>InstaFont</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 900px;
        margin: 20px auto;
        padding: 24px 30px;
        background: #f5f7fa;
        color: #2c3e50;
        line-height: 1.6;
      }
      h1 {
        font-size: 2rem;
        margin-bottom: 30px;
        text-align: center;
        color: #34495e;
      }
      label {
        font-weight: 600;
        margin-bottom: 0.5em;
        display: block;
        font-size: 1.125em;
        color: #34495e;
      }
      .note {
        font-size: 0.9em;
        color: #666;
        margin-top: 10px;
        margin-bottom: 10px;
        font-style: italic;
      }
      .font-size-container {
        background: #fff;
        padding: 20px 25px 30px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgb(0 0 0 / 0.08);
        margin-bottom: 30px;
      }
      input[type="number"],
      select {
        font-size: 1rem;
        padding: 8px 14px;
        margin-right: 20px;
        border-radius: 8px;
        border: 1.8px solid #bdc3c7;
        box-shadow: inset 0 2px 6px #e2e6ec;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
        min-width: 130px;
        outline-offset: 2px;
        cursor: pointer;
        font-family: inherit;
      }
      input[type="number"]:focus,
      select:focus {
        border-color: #3498db;
        box-shadow: 0 0 8px rgba(52, 152, 219, 0.6);
        outline: none;
      }
      #inputText {
        min-height: 140px;
        border: 1.8px solid #bdc3c7;
        border-radius: 12px;
        padding: 16px 18px;
        font-family: "Yu Gothic UI", "Segoe UI", sans-serif;
        font-size: 1rem;
        box-shadow: inset 0 4px 10px #dfe4eb;
        overflow-y: auto;
        resize: vertical;
        white-space: pre-wrap;
        word-break: break-word;
      }
      .toolbar {
        display: flex;
        padding: 5px 25px 30px;
        gap: 5px;
      }
      .toolbar-label {
        margin-bottom: 0px;
      }
      .toolbar .btn {
        margin: 0px;
        padding: 0px;
        height: 40px;
        width: 40px;
        background-color: #ffffff;
        outline: none;
        border: none;
        font-size: 1rem;
        box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.25);
        border-radius: 5px;
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .toolbar .btn:hover {
        background-color: #2c80cc;
        color: #ffffff;
        transition: all 0.3s ease;
      }
      .btnForCode {
        display: inline-block;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1.1em;
        font-weight: 600;
        padding: 14px 28px;
        cursor: pointer;
        margin: 25px 12px 35px 0;
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.35);
      }
      button:hover {
        background-color: #2c80cc;
      }
      #btnCopy {
        background-color: #27ae60;
      }
      #btnCopy:hover {
        background-color: #1e8449;
      }
      .output-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
        margin-bottom: 30px;
      }
      #output,
      #nonEnglishOutput {
        min-width: 0;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
        word-break: break-word;
        padding: 20px 24px;
        border-radius: 12px;
        font-family: "Courier New", Courier, monospace;
        font-size: 1rem;
      }
      .output-label {
        display: block;
        font-weight: 700;
        font-size: 1.1rem;
        color: #34495e;
        margin-bottom: 8px;
      }
      #output {
        background: #272822;
        color: #f8f8f2;
        box-shadow: inset 0 0 16px #222;
      }
      #nonEnglishOutput {
        background: #eaf4fc;
        color: #1a3d7c;
        box-shadow: inset 0 0 8px #cbe0fc;
        position: relative;
      }
      .highlight-nonenglish {
        background-color: #a9d1ff;
        color: #003366;
        font-weight: bold;
        border-radius: 4px;
        padding: 0 4px;
      }
      .tag {
        color: #ff5370;
        font-weight: 700;
        text-shadow: 0 0 4px #ff3a58;
      }
      .attr {
        color: #82aaff;
        font-weight: 600;
        text-shadow: 0 0 5px #7199ff;
      }
      .value {
        color: #c3e88d;
        font-style: normal;
        font-weight: 600;
        text-shadow: 0 0 4px #a7d86b;
      }
      .punct {
        color: #f8f8f2;
        font-weight: 800;
      }
      .char-span {
        position: relative;
        cursor: help;
        white-space: pre;
      }
      .char-span .tooltip {
        position: absolute;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        background-color: #222d48;
        color: #f0f0f0;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 0.85rem;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        z-index: 10;
        max-width: 300px;
        word-break: normal;
      }
      .char-span:hover .tooltip,
      .char-span:focus .tooltip {
        opacity: 1;
        pointer-events: auto;
      }
      .char-span .tooltip::after {
        content: "";
        position: absolute;
        border-width: 6px;
        border-style: solid;
        border-color: #222d48 transparent transparent transparent;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
      }
      .preview-wrapper {
        width: 660px;
        padding: 0 24px;
        margin: 0 auto 50px;
        box-sizing: border-box;
      }
      #previewArea {
        border: 1.5px solid #ccc;
        background: #fff;
        border-radius: 12px;
        padding: 20px 24px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        font-family: "Segoe UI", sans-serif;
        font-size: 1rem;
        line-height: 1.7;
        color: #333;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>InstaFont</h1>
    <div class="note">
      Disclaimer: This application only formats the appropriate font family per
      language and does not apply any styling such as padding, margin,
      positioning, color, bold, or italic, as it only accepts plain text. Future
      developments will be implemented.
    </div>

    <div class="font-size-container">
      <label for="fontSizeInput">Font size (pt):</label>
      <input
        type="number"
        id="fontSizeInput"
        min="10.5"
        max="15"
        value="10.5"
        step="0.1"
      />

      <label for="languageSelect">Language group:</label>
      <select id="languageSelect">
        <option value="'Segoe Pro'">Latin, Greek, Cyrillic</option>
        <option value="'Segoe UI'">Hebrew, Armenian, Georgian</option>
        <option value="'Segoe UI'">Arabic</option>
        <option value="'Nirmala UI'">Indian Languages</option>
        <option value="Leelawadee">Thai</option>
        <option value="Gadugi">Indigenous American</option>
        <option value="'Microsoft YaHei UI'">Chinese (Simplified)</option>
        <option value="'Microsoft JhengHei UI'">Chinese (Traditional)</option>
        <option value="'Malgun Gothic'">Korean</option>
        <option value="'Yu Gothic UI'" selected>Japanese</option>
        <option value="'Lao UI'">Lao</option>
      </select>
      <span class="note">Choose language for corresponding font style</span>
    </div>
    <label class="toolbar-label" for="languageSelect">Toolbar</label>
    <div class="toolbar">
      <button class="btn"><b>B</b></button>
      <button class="btn"><i>I</i></button>
      <button class="btn"><u>U</u></button>
      <button class="btn"><s> S </s></button>
      <button class="btn">üîó</button>
      <input type="color" id="colorPicker" />
      <button class="btn">‚úñÔ∏è</button>
      <button class="btn">üîó‚úñ</button>
      <button class="btn">A<sub>x</sub></button>
      <button class="btn">A<sup>x</sup></button>
      <button class="btn">OL</button>
      <button class="btn">UL</button>
      <button class="btn"><b>‚Üí</b></button>
      <button class="btn"><b>‚Üê</b></button>
    </div>
    <label for="inputText">Enter your text below:</label>
    <div
      id="inputText"
      contenteditable="true"
      role="textbox"
      aria-multiline="true"
      spellcheck="true"
      placeholder="Paste your text here‚Ä¶"
    ></div>

    <button class="btnForCode" onclick="formatText()">Format Text</button>
    <button class="btnForCode" id="btnCopy" onclick="copyOutput()">
      Copy Code
    </button>

    <div class="output-container">
      <div>
        <label for="output" class="output-label"
          >Formatted HTML Code Output</label
        >
        <pre id="output" readonly></pre>
      </div>
      <div>
        <label for="nonEnglishOutput" class="output-label"
          >Non-English Characters Highlighted</label
        >
        <pre id="nonEnglishOutput" readonly></pre>
      </div>
    </div>
    <div class="preview-wrapper">
      <label class="output-label">Preview Email</label>
      <div id="previewArea"></div>
    </div>

    <script>
      let rawFormattedHTML = "";

      function escapeHTML(str) {
        return str
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      function syntaxHighlight(html) {
        let escaped = escapeHTML(html);

        escaped = escaped.replace(
          /(&lt;)(\/?)([\w-]+)([^&]*?)(&gt;)/g,
          (match, lt, slash, tagName, attrs, gt) => {
            let highlightedTag = `<span class="tag">${tagName}</span>`;
            let highlightedAttrs = attrs.replace(
              /([\w-]+)(=)(&quot;[^&]*?&quot;)/g,
              (m, attrName, eq, attrValue) =>
                `<span class="attr">${attrName}</span><span class="punct">${eq}</span><span class="value">${attrValue}</span>`
            );
            return `<span class="punct">${lt}</span>${slash}${highlightedTag}${highlightedAttrs}<span class="punct">${gt}</span>`;
          }
        );

        escaped = escaped.replace(/(&lt;span[^&]*?&gt;)/g, "\n$1");

        return escaped;
      }

      function highlightNonEnglishChars(text, selectedFont) {
        const fontSizeInput = document.getElementById("fontSizeInput");
        const fontSize = fontSizeInput ? fontSizeInput.value.trim() : "10.5";

        const chars = [...text];

        return chars
          .map((char) => {
            const isNonEnglish = /[^\x00-\x7F]/.test(char);
            const fontFamily = isNonEnglish ? selectedFont : "'Segoe UI'";
            const highlightClass = isNonEnglish ? "highlight-nonenglish" : "";
            const escapedChar = char === " " ? "\u00A0" : escapeHTML(char);

            const tooltipText = `Font: ${fontFamily.replace(
              /'/g,
              ""
            )}, Size: ${fontSize}pt`;

            return `<span class="char-span ${highlightClass}" tabindex="0" style="font-family:${fontFamily}">${escapedChar}<span class="tooltip">${tooltipText}</span></span>`;
          })
          .join("");
      }

      function addSpacesBetweenJapaneseAndEnglish(text) {
        return text
          .replace(
            /([\p{Script=Hiragana}\p{Script=Katakana}\p{Script=Han}])([A-Za-z0-9])/gu,
            "$1 $2"
          )
          .replace(
            /([A-Za-z0-9])([\p{Script=Hiragana}\p{Script=Katakana}\p{Script=Han}])/gu,
            "$1 $2"
          );
      }

      function processTextNode(node) {
        let text = node.textContent;
        text = addSpacesBetweenJapaneseAndEnglish(text);

        const parts = text.split(/([A-Za-z0-9]+)/g);
        if (parts.length > 1) {
          const fragment = document.createDocumentFragment();
          parts.forEach((part) => {
            if (/^[A-Za-z0-9]+$/.test(part)) {
              const span = document.createElement("span");
              span.style.fontFamily = "'Segoe UI', sans-serif";
              span.textContent = part;
              fragment.appendChild(span);
            } else {
              fragment.appendChild(document.createTextNode(part));
            }
          });
          node.replaceWith(fragment);
        } else {
          if (text !== node.textContent) {
            node.textContent = text;
          }
        }
      }

      function wrapEnglishAndAddSpaces(node) {
        if (node.nodeType === Node.TEXT_NODE) {
          processTextNode(node);
        } else if (node.nodeType === Node.ELEMENT_NODE) {
          const skipTags = ["STYLE", "SCRIPT"];
          if (!skipTags.includes(node.tagName)) {
            Array.from(node.childNodes).forEach(wrapEnglishAndAddSpaces);
          }
        }
      }

      function rgbToHex(rgb) {
        const result = rgb.match(/\d+/g);
        if (!result || result.length < 3) return rgb;
        return (
          "#" +
          result
            .slice(0, 3)
            .map((x) => {
              const hex = parseInt(x).toString(16);
              return hex.length === 1 ? "0" + hex : hex;
            })
            .join("")
        );
      }

      function cleanFormattedHTML(html) {
        const container = document.createElement("div");
        container.innerHTML = html;

        // Convert <b> to <strong>; <i> to <em>
        container.querySelectorAll("b").forEach((b) => {
          const strong = document.createElement("strong");
          strong.innerHTML = b.innerHTML;
          b.parentNode.replaceChild(strong, b);
        });
        container.querySelectorAll("i").forEach((i) => {
          const em = document.createElement("em");
          em.innerHTML = i.innerHTML;
          i.parentNode.replaceChild(em, i);
        });

        // Remove fontWeight/fontStyle styles from spans with <strong> and <em>
        container.querySelectorAll("span").forEach((span) => {
          const style = span.style;
          const hasBold =
            style.fontWeight === "bold" || style.fontWeight === "700";
          const hasItalic = style.fontStyle === "italic";

          if (hasBold || hasItalic) {
            let newNode = null;
            if (hasBold && hasItalic) {
              const strong = document.createElement("strong");
              const em = document.createElement("em");
              em.innerHTML = span.innerHTML;
              strong.appendChild(em);
              newNode = strong;
            } else if (hasBold) {
              const strong = document.createElement("strong");
              strong.innerHTML = span.innerHTML;
              newNode = strong;
            } else if (hasItalic) {
              const em = document.createElement("em");
              em.innerHTML = span.innerHTML;
              newNode = em;
            }
            if (newNode) {
              span.parentNode.replaceChild(newNode, span);
            }
          }
        });

        // Convert <u> to span with underline style
        container.querySelectorAll("u").forEach((u) => {
          const span = document.createElement("span");
          span.style.textDecoration = "underline";
          while (u.firstChild) {
            span.appendChild(u.firstChild);
          }
          u.parentNode.replaceChild(span, u);
        });

        // Convert <s> to span with line-through style
        container.querySelectorAll("s").forEach((s) => {
          const span = document.createElement("span");
          span.style.textDecoration = "line-through";
          while (s.firstChild) {
            span.appendChild(s.firstChild);
          }
          s.parentNode.replaceChild(span, s);
        });

        // Convert rgb() colors to hex in style attributes
        container.querySelectorAll("span[style]").forEach((span) => {
          let styleText = span.getAttribute("style");
          const rgbPattern = /rgb\((\d+),\s*(\d+),\s*(\d+)\)/g;
          styleText = styleText.replace(rgbPattern, (match) => rgbToHex(match));
          span.setAttribute("style", styleText);
        });

        return container.innerHTML;
      }

      function formatText() {
        let inputHTML = document.getElementById("inputText").innerHTML || "";
        let plainText = document.getElementById("inputText").innerText || "";
        let fontSize = document.getElementById("fontSizeInput").value.trim();
        let languageSelect = document.getElementById("languageSelect");
        let selectedFont = languageSelect.value;
        let selectedText = languageSelect.selectedOptions[0].text;

        if (!plainText.trim()) {
          alert("Please enter some text to format.");
          return;
        }

        if (!fontSize || isNaN(fontSize) || fontSize <= 0) {
          alert("Please enter a valid positive font size.");
          return;
        }

        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = inputHTML;

        if (selectedFont === "'Yu Gothic UI'") {
          wrapEnglishAndAddSpaces(tempDiv);
        }

        let wrapperTag = selectedFont === "'Yu Gothic UI'" ? "div" : "p";
        let dirAttr = selectedText === "Arabic" ? ' dir="rtl"' : "";
        let extraStyle = selectedText === "Arabic" ? "text-align: right;" : "";

        rawFormattedHTML = `<${wrapperTag} style="font-family:${selectedFont};font-size: ${fontSize}pt;${extraStyle}"${dirAttr}>${tempDiv.innerHTML}</${wrapperTag}>`;

        rawFormattedHTML = cleanFormattedHTML(rawFormattedHTML);

        document.getElementById("output").innerHTML =
          syntaxHighlight(rawFormattedHTML);
        document.getElementById("nonEnglishOutput").innerHTML =
          highlightNonEnglishChars(plainText, selectedFont);

        document.getElementById("previewArea").innerHTML = rawFormattedHTML;
      }

      function copyOutput() {
        if (!rawFormattedHTML) {
          alert("No formatted code to copy. Please format your text first.");
          return;
        }

        const formattedForCopy = rawFormattedHTML.replace(/<span/g, "\n<span");

        navigator.clipboard.writeText(formattedForCopy).then(
          () => {
            alert("Formatted HTML code copied to clipboard!");
          },
          () => {
            alert("Failed to copy. Please copy manually.");
          }
        );
      }

      const toolbar = document.querySelector(".toolbar");

      toolbar.addEventListener("click", (e) => {
        if (e.target.classList.contains("btn")) {
          e.preventDefault();

          const btn = e.target;
          const inputTextDiv = document.getElementById("inputText");

          inputTextDiv.focus();

          switch (btn.textContent.trim()) {
            case "B":
              document.execCommand("bold");
              break;
            case "I":
              document.execCommand("italic");
              break;
            case "U":
              document.execCommand("underline");
              break;
            case "S":
              document.execCommand("strikeThrough");
              break;
            case "üîó":
              {
                let url = prompt("Enter URL for the link:", "https://");
                if (url) {
                  document.execCommand("createLink", false, url);
                }
              }
              break;
            case "‚úñÔ∏è": // Remove Color
              removeColor();
              break;
            case "üîó‚úñ": // Remove Link
              document.execCommand("unlink");
              break;
            case "A‚Çì":
              document.execCommand("subscript");
              break;
            case "AÀ£":
              document.execCommand("superscript");
              break;
            case "OL":
              document.execCommand("insertOrderedList");
              break;
            case "UL":
              document.execCommand("insertUnorderedList");
              break;
            case "‚Üí":
              document.execCommand("indent");
              break;
            case "‚Üê":
              document.execCommand("outdent");
              break;
            default:
              break;
          }
        }
      });

      function applyColorSpan(color) {
        const inputTextDiv = document.getElementById("inputText");
        const selection = window.getSelection();

        if (!selection.rangeCount) return;

        const range = selection.getRangeAt(0);

        if (!inputTextDiv.contains(range.commonAncestorContainer)) return;

        if (range.collapsed) return;

        const span = document.createElement("span");
        span.style.color = color;

        const selectedContents = range.extractContents();
        span.appendChild(selectedContents);
        range.insertNode(span);

        selection.removeAllRanges();
        const newRange = document.createRange();
        newRange.setStartAfter(span);
        newRange.collapse(true);
        selection.addRange(newRange);

        inputTextDiv.focus();
      }

      function removeColor() {
        const selection = window.getSelection();
        if (!selection.rangeCount) return;
        const range = selection.getRangeAt(0);
        if (range.collapsed) return;

        const container = document.createElement("div");
        container.appendChild(range.cloneContents());

        // Remove color style attributes from spans in selected content
        container.querySelectorAll("span").forEach((span) => {
          span.style.color = "";
          if (span.getAttribute("style") === "") {
            span.removeAttribute("style");
          }
        });

        range.deleteContents();
        const frag = document.createDocumentFragment();
        while (container.firstChild) {
          frag.appendChild(container.firstChild);
        }
        range.insertNode(frag);
      }

      const colorInput = document.getElementById("colorPicker");
      colorInput.addEventListener("input", (e) => {
        applyColorSpan(e.target.value);
      });
    </script>
  </body>
</html>
